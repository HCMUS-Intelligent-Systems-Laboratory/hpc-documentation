[[{"l":"Hướng dẫn sử dụng SLURM cho người dùng cuối","p":["SLURM (Simple Linux Utility for Resource Management) là một hệ thống quản lý tài nguyên và điều phối tác vụ (job scheduler) mã nguồn mở, được sử dụng rộng rãi trong các hệ thống tính toán hiệu năng cao (High Performance Computing - HPC). Thay vì để từng người dùng truy cập trực tiếp vào tài nguyên tính toán (như các node hay CPU), SLURM giúp phân phối tài nguyên một cách công bằng, hiệu quả, và dễ quản lý.","Người dùng nên làm quen với cú pháp và các lệnh cơ bản để sử dụng SLURM hiệu quả. Hãy thường xuyên tham khảo tài liệu và các hướng dẫn cụ thể khi cần thiết để giải quyết các vấn đề phát sinh trong quá trình sử dụng."]}],[{"l":"Khái niệm và yêu cầu cơ bản"},{"l":"Các khái niệm cơ bản","p":["Job: Tác vụ hoặc chương trình bạn muốn hệ thống chạy.","Node: Một máy tính riêng biệt trong cụm máy (cluster)."]},{"l":"Yêu cầu cơ bản để sử dụng SLURM","p":["Trước khi bắt đầu, người dùng cần nắm vững một số kiến thức cơ bản về Linux và cái nhìn tổng quan về hệ thống HPC.","Hệ thống server HPC hiện tại bao gồm:","02 login nodes: chỉ dùng để đăng nhập thông qua ssh, lưu trữ mã nguồn và dữ liệu, nộp job lên các compute nodes, không dùng cho việc chạy task/job xử lý dữ liệu hoặc huấn luyện mô hình.","Node login01 có IP: 172.29.74.80","Node login02 có IP: 172.29.74.81","05 compute nodes: có nguồn tài nguyên lớn bao gồm CPUs, RAM và GPUs, được điều phối tự động thông qua SLURM để chạy các task/job, người dùng không thể đăng nhập hay kết nối trực tiếp đến các compute nodes.","gpu01, gpu02, gpu03, gpu04, gpu05"]}],[{"l":"Chạy một job đơn giản"},{"l":"Dùng srun chạy trực tiếp:","p":["srun là lệnh được dùng để chạy một chương trình hoặc lệnh trực tiếp trên hệ thống tính toán sử dụng SLURM. Khi dùng srun, bạn sẽ yêu cầu tài nguyên (CPU, RAM, GPU,...) và SLURM sẽ cấp phát tài nguyên tương ứng để chạy chương trình. srun phù hợp cho các tác vụ nhanh, thử nghiệm hoặc chạy tương tác trong môi trường dòng lệnh. Ví dụ được minh họa bên dưới.","Yêu cầu 4GB RAM và 1 GPU:","Khi chạy lệnh trên, yêu cầu sẽ vào hàng đợi, nếu SLURM tìm đủ tài nguyên để cấp phát, job này sẽ được khởi chạy và khi đó người dùng sẽ được kết nối đến một trong các compute nodes và truy cập tới vùng tài nguyên được yêu cầu bao gồm 4GB RAM và 1 GPU."]},{"l":"Dùng sbatch để gửi script:","p":["sbatch là lệnh dùng để gửi một script (thường là file .sh) vào hệ thống SLURM để chạy không đồng bộ. Nghĩa là bạn không cần chờ kết quả ngay trên terminal - hệ thống sẽ xếp hàng, cấp phát tài nguyên khi có thể và chạy script của bạn. sbatch phù hợp cho các tác vụ dài, tốn nhiều thời gian, phức tạp hoặc cần nhiều tài nguyên.","Một script SLURM cần phải bao gồm ba phần chính:","Quy định tài nguyên: Kích thước bộ nhớ, số lượng CPU cores, số nút, thời gian chạy tối đa.","Thiết lập môi trường: Tải các module cần thiết hoặc kích hoạt môi trường ảo.","Lệnh thực thi: Lệnh mà người dùng muốn chạy.","Dưới đây là một ví dụ về script SLURM để chạy một chương trình Python:","Để gửi một job, người dùng sử dụng lệnh sbatch:","Trong đó job.slurm là tên của file script SLURM. Để kiểm tra kết quả của quá trình chạy script bằng lệnh sbatch, các output của các câu lệnh trong script sẽ được ghi vào 1 file job_id.out.","Lưu ý quan trọng: Để tiến hành huấn luyện một mô hình AI hoặc chạy một script nào đó trên SLURM, bạn nên chạy các câu lệnh của mình bằng lệnh srun trước và đảm bảo rằng toàn bộ các câu lệnh trong script của bạn chạy đúng và trả ra kết quả, sau đó bạn đưa các câu lệnh theo đúng trình tự vào script của lệnh sbatch và nộp lên để SLURM xử lý ngầm."]}],[{"l":"Kiểm tra trạng thái Job","p":["Sau khi nộp job lên SLURM bằng lệnh sbatch, nên kiểm tra danh sách các job đang chạy hoặc đang chờ trong hàng đợi, người dùng có thể sử dụng lệnh:","Để xem thời gian bắt đầu dự kiến cho job đang chờ xử lý:","Trường hợp ngay sau khi nộp job bằng sbatch mà không thấy job của mình nằm trong hàng đợi, khả năng cao là job đã bị lỗi và cần kiểm tra file output."]},{"l":"Các lệnh SLURM thường dùng*","p":["Dưới đây là một số lệnh SLURM phổ biến cần sử dụng:","squeue: Kiểm tra trạng thái của các job.","scancel: Hủy một job đang chạy hoặc trong hàng đợi.","scontrol: Hiển thị thông tin chi tiết về một job cụ thể.","sinfo: Hiển thị thông tin các nodes."]}],[{"l":"Lưu ý quan trọng khi sử dụng hệ thống","p":["Toàn bộ source code và dữ liệu cần được lưu ở đường dẫn /media/{username} hoặc /media02/{username}","Tuyệt đối không lưu dữ liệu ở /home/{username} do không có nhiều dung lượng lưu trữ tại đây.","Lưu ý: đối với thư mục ẩn (ví dụ như /home/{username}/.cache) cũng phải được chuyển qua /media/{username}.","Không chạy bất kỳ chương trình xử lý data / huấn luyện mô hình nào trên các login nodes, vì login nodes không có cấu hình cao, và được nhiều nhóm nghiên cứu sử dụng chung.","Sau khi hoàn tất sử dụng, ngắt kết nối (ssh), đặc biệt đối với các nhóm sử dụng VSCode, vì nếu không ngắt kết nối sẽ làm chậm kết nối chung của tất cả các nhóm sử dụng.","Đảm bảo rằng các yêu cầu về tài nguyên được chỉ định chính xác và vừa đủ trước khi gửi job.","Tính toán thêm 20% cho thời gian dự kiến của job để tránh việc job bị hủy do vượt quá giới hạn thời gian.","Kiểm tra các thông báo từ SLURM để tối ưu hóa yêu cầu tài nguyên cho các job trong tương lai.","Thường xuyên backup mã nguồn và dữ liệu (2 ngày / lần), hệ thống có thể sẽ xóa dữ liệu định kỳ (có thông báo trước 3-5 ngày làm việc)."]}]]